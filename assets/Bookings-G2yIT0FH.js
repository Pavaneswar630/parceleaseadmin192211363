import{c as F,r as c,j as e,S as V}from"./index-B-nlBq4c.js";import{F as I,D as P,S as $}from"./StatusBadge-l58BJ9iI.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=F("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),R=["pending","in-transit","delivered","cancelled","active","blocked","open","closed","Confirmed","failed"],O=["normal","expressdelivery"];function X(s){return R.includes(s)}function H(s){return O.includes(s)}function Y(s,y){const d=["Booking ID","User ID","Pickup Location","Drop Location","Delivery Type","Date","Status"],f=s.filter(r=>r.status==="Confirmed").map(r=>[r.parcel_id,r.user_id,r.pickup_location,r.drop_location,r.deliverytype,new Date(r.created_at).toLocaleDateString(),r.status]),p=[d,...f].map(r=>r.map(m=>`"${String(m).replace(/"/g,'""')}"`).join(",")).join(`
`),n=new Blob([p],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(n),i=document.createElement("a");i.setAttribute("href",g),i.setAttribute("download",`${y}.csv`),i.click()}function q(s){return{...s,status:X(s.status)?s.status:"pending",deliverytype:H(s.deliverytype)?s.deliverytype:"normal"}}function K(){const[s,y]=c.useState("all"),[d,x]=c.useState([]),[f,p]=c.useState(!1),[n,g]=c.useState(null),[i,r]=c.useState(""),[m,j]=c.useState([]),[b,h]=c.useState(!1),[C,v]=c.useState(""),[S,N]=c.useState(""),[_,k]=c.useState(()=>{});c.useEffect(()=>{fetch("http://localhost:4000/api/bookings").then(t=>t.json()).then(t=>{const a=t.map(q);j(a)}).catch(t=>console.error("Failed to fetch bookings:",t))},[]);const D=t=>y(t),B=t=>{x(a=>a.includes(t)?a.filter(o=>o!==t):[...a,t])},T=t=>{t.target.checked?x(u.map(a=>a.parcel_id)):x([])},L=t=>{g(t),p(!0)},w=()=>p(!1),A=async t=>{try{if(!(await fetch(`http://localhost:4000/api/bookings/${t}/cancel`,{method:"PUT"})).ok)throw new Error("Failed to cancel booking");j(o=>o.map(l=>l.parcel_id===t?{...l,status:"cancelled"}:l))}catch(a){console.error(a)}},U=async t=>{try{if(!(await fetch(`http://localhost:4000/api/bookings/${t}/confirm`,{method:"PUT"})).ok)throw new Error("Failed to confirm booking");j(o=>o.map(l=>l.parcel_id===t?{...l,status:"Confirmed"}:l))}catch(a){console.error(a)}},z=t=>{v("Confirm Booking"),N("Are you sure you want to confirm this booking?"),k(()=>()=>U(t)),h(!0)},E=t=>{v("Cancel Booking"),N("Are you sure you want to cancel this booking?"),k(()=>()=>A(t)),h(!0)},u=m.filter(t=>{const a=s==="all"||t.status===s,o=i.toLowerCase();return a&&(t.parcel_id.toLowerCase().includes(o)||t.user_id.toLowerCase().includes(o)||t.pickup_location.toLowerCase().includes(o)||t.drop_location.toLowerCase().includes(o))});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Bookings Management"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[e.jsx(I,{size:18,className:"mr-2 text-gray-500"})," Filter"]}),e.jsxs("button",{type:"button",onClick:()=>Y(m,"confirmed_bookings"),className:"flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[e.jsx(P,{size:18,className:"mr-2 text-gray-500"}),"Export CSV"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex space-x-1 border-b border-gray-200",children:["all","pending","in-transit","delivered","cancelled"].map(t=>e.jsx("button",{className:`px-4 py-2 text-sm font-medium ${s===t?"text-primary-600 border-b-2 border-primary-500":"text-gray-500 hover:text-gray-700"}`,onClick:()=>D(t),children:t==="all"?"All":t.charAt(0).toUpperCase()+t.slice(1)},t))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search bookings...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",value:i,onChange:t=>r(t.target.value)}),e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-custom overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-primary-600",checked:d.length===u.length&&u.length>0,onChange:T})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Booking ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pickup → Drop"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-primary-600",checked:d.includes(t.parcel_id),onChange:()=>B(t.parcel_id)})}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium",children:t.parcel_id}),e.jsx("td",{className:"px-6 py-4 text-sm text-text-secondary",children:t.user_id}),e.jsxs("td",{className:"px-6 py-4 text-sm text-text-secondary",children:[t.pickup_location," → ",t.drop_location]}),e.jsx("td",{className:"px-6 py-4 text-sm text-text-secondary",children:t.deliverytype}),e.jsx("td",{className:"px-6 py-4 text-sm text-text-secondary",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx($,{status:t.status,size:"sm"})}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium space-x-3",children:[e.jsx("button",{className:"text-primary-600 hover:text-primary-900",onClick:()=>L(t),children:"View"}),e.jsx("button",{className:"text-green-600 hover:text-green-800",onClick:()=>z(t.parcel_id),disabled:t.status==="Confirmed",children:"Confirm"}),e.jsx("button",{className:"text-red-600 hover:text-red-800",onClick:()=>E(t.parcel_id),disabled:t.status==="cancelled",children:"Cancel"})]})]},t.parcel_id))})]})})}),f&&n&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-75",onClick:w}),e.jsxs("div",{className:"absolute inset-y-0 right-0 max-w-md w-full bg-white shadow-xl p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Booking #",n.parcel_id]}),e.jsx("button",{onClick:w,children:e.jsx(M,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"User ID:"})," ",n.user_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pickup:"})," ",n.pickup_location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Drop:"})," ",n.drop_location]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",n.deliverytype]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",n.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(n.created_at).toLocaleDateString()]})]})]})]}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-md max-w-sm w-full",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:C}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:S}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded-md",onClick:()=>h(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-primary-600 text-white rounded-md",onClick:()=>{_(),h(!1)},children:"Yes"})]})]})})]})}export{K as default};
